<!DOCTYPE html>
<html>
<head>
    <title>Direct Sprite Test</title>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: #0f0; font-family: monospace; }
        #game { width: 800px; height: 600px; border: 2px solid #0f0; margin: 20px auto; }
        #log { background: #000; padding: 10px; margin: 10px 0; height: 200px; overflow-y: auto; }
        .error { color: #f00; }
    </style>
</head>
<body>
    <h1>Direct Sprite Test - No Server</h1>
    <div id="game"></div>
    <div id="log"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script>
        const log = (msg, isError = false) => {
            const el = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = isError ? 'error' : '';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            el.appendChild(entry);
            el.scrollTop = el.scrollHeight;
            console.log(msg);
        };

        class TestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'test' });
            }
            
            preload() {
                log('Preload started');
                
                // Generate sprite directly
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const size = 32;
                
                canvas.width = size * 4;
                canvas.height = size * 4;
                
                // Draw a simple colored square for each frame
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const x = col * size;
                        const y = row * size;
                        
                        // Different color for each row (direction)
                        const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12'];
                        ctx.fillStyle = colors[row];
                        ctx.fillRect(x + 4, y + 4, size - 8, size - 8);
                        
                        // Add frame number
                        ctx.fillStyle = '#fff';
                        ctx.font = '10px monospace';
                        ctx.fillText(String(row * 4 + col), x + 12, y + 20);
                    }
                }
                
                // Try both methods
                try {
                    // Method 1: addSpriteSheet
                    this.textures.addSpriteSheet('test1', canvas, {
                        frameWidth: size,
                        frameHeight: size
                    });
                    log('✅ addSpriteSheet succeeded');
                } catch (e) {
                    log('❌ addSpriteSheet failed: ' + e.message, true);
                }
                
                try {
                    // Method 2: addCanvas then add frames
                    const canvas2 = document.createElement('canvas');
                    const ctx2 = canvas2.getContext('2d');
                    canvas2.width = size * 4;
                    canvas2.height = size * 4;
                    ctx2.drawImage(canvas, 0, 0);
                    
                    this.textures.addCanvas('test2', canvas2);
                    const texture = this.textures.get('test2');
                    
                    for (let i = 0; i < 16; i++) {
                        const col = i % 4;
                        const row = Math.floor(i / 4);
                        texture.add(String(i), 0, col * size, row * size, size, size);
                    }
                    log('✅ addCanvas + frames succeeded');
                } catch (e) {
                    log('❌ addCanvas + frames failed: ' + e.message, true);
                }
            }
            
            create() {
                log('Create started');
                
                // Test rendering both sprites
                try {
                    const sprite1 = this.add.sprite(200, 200, 'test1', 0);
                    sprite1.setScale(3);
                    this.add.text(200, 280, 'addSpriteSheet', { color: '#fff' }).setOrigin(0.5);
                    log('✅ Sprite 1 created');
                    
                    // Animate it
                    this.anims.create({
                        key: 'anim1',
                        frames: this.anims.generateFrameNumbers('test1', { start: 0, end: 15 }),
                        frameRate: 4,
                        repeat: -1
                    });
                    sprite1.play('anim1');
                } catch (e) {
                    log('❌ Sprite 1 failed: ' + e.message, true);
                }
                
                try {
                    const sprite2 = this.add.sprite(400, 200, 'test2', '0');
                    sprite2.setScale(3);
                    this.add.text(400, 280, 'addCanvas', { color: '#fff' }).setOrigin(0.5);
                    log('✅ Sprite 2 created');
                    
                    // Animate it
                    this.anims.create({
                        key: 'anim2',
                        frames: [
                            { key: 'test2', frame: '0' },
                            { key: 'test2', frame: '1' },
                            { key: 'test2', frame: '2' },
                            { key: 'test2', frame: '3' }
                        ],
                        frameRate: 4,
                        repeat: -1
                    });
                    sprite2.play('anim2');
                } catch (e) {
                    log('❌ Sprite 2 failed: ' + e.message, true);
                }
                
                // Test which frame format works
                try {
                    const frames1 = this.textures.get('test1').getFrameNames();
                    log('test1 frames: ' + frames1.join(', '));
                } catch (e) {
                    log('Could not get test1 frames', true);
                }
                
                try {
                    const frames2 = this.textures.get('test2').getFrameNames();
                    log('test2 frames: ' + frames2.join(', '));
                } catch (e) {
                    log('Could not get test2 frames', true);
                }
            }
        }
        
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game',
            scene: TestScene
        };
        
        const game = new Phaser.Game(config);
        log('Game initialized');
    </script>
</body>
</html>